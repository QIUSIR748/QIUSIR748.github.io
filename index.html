<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCL-90症状自评量表</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .page {
            background: white;
            padding: 40px 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 16px;
            font-size: 28px;
            font-weight: 600;
            text-align: center;
        }
        
        h2 {
            color: #2c3e50;
            margin: 25px 0 15px 0;
            font-size: 20px;
            font-weight: 600;
        }
        
        h3 {
            color: #2c3e50;
            margin: 20px 0 10px 0;
            font-size: 16px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 16px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .description {
            color: #555;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .scoring-section {
            margin: 25px 0;
        }
        
        .scoring-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .scoring-explanation {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #555;
        }
        
        .scoring-explanation div {
            flex: 1;
            text-align: center;
            padding: 0 5px;
        }
        
        .note {
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }
        
        .start-section {
            text-align: center;
            margin: 30px 0;
        }
        
        .start-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 14px 40px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 500;
            margin: 20px 0;
        }
        
        .start-btn:hover {
            background: #2980b9;
        }
        
        .important-note {
            background: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 25px;
        }
        
        .important-note p {
            margin-bottom: 10px;
        }
        
        hr {
            border: none;
            height: 1px;
            background: #e9ecef;
            margin: 25px 0;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* 问题页面样式 */
        #question-page {
            display: none;
        }
        
        .question-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .progress-container {
            margin-bottom: 20px;
        }
        
        .progress-bar {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .question {
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .option {
            flex: 1;
            min-width: 120px;
        }
        
        .option label {
            display: block;
            padding: 12px;
            background: #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .option input {
            display: none;
        }
        
        .option input:checked + label {
            background: #3498db;
            color: white;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .navigation button {
            padding: 10px 20px;
        }
        
        #prev-btn {
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        #prev-btn:hover {
            background: #7f8c8d;
        }
        
        /* 结果页面样式 */
        #result-container {
            display: none;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .result-title {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .result-subtitle {
            color: #e74c3c; /* 修改为红色 */
            font-size: 14px; /* 保持原有字号 */
            font-weight: 500;
        }
        
        .total-score-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .score-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .score-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .score-value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .score-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .score-range {
            font-size: 12px;
            color: #95a5a6;
        }
        
        .score-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-positive {
            background: #e74c3c;
            color: white;
        }
        
        .status-normal {
            background: #2ecc71;
            color: white;
        }
        
        .status-mild {
            background: #f39c12;
            color: white;
        }
        
        .status-moderate {
            background: #e67e22;
            color: white;
        }
        
        .status-severe {
            background: #c0392b;
            color: white;
        }
        
        .chart-container {
            margin: 20px 0;
        }
        
        .chart-bar {
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            margin-bottom: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .chart-fill {
            height: 100%;
            border-radius: 10px;
            background: #3498db;
            width: 0%;
            transition: width 1s ease-in-out;
        }
        
        .chart-label {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .factors-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        
        .factors-table th {
            background: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 1px solid #e9ecef;
        }
        
        .factors-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .factors-table tr:hover {
            background: #f8f9fa;
        }
        
        .factor-analysis {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .factor-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .factor-score-display {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .factor-score-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin-right: 20px;
        }
        
        .factor-score-bar {
            flex-grow: 1;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .factor-score-fill {
            height: 100%;
            background: #3498db;
            width: 0%;
            transition: width 1s ease-in-out;
        }
        
        .factor-ranges {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        .range-label {
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
            margin: 0 5px;
        }
        
        .range-normal {
            background: #e9ecef;
            color: #7f8c8d;
        }
        
        .range-mild {
            background: #e9ecef;
            color: #7f8c8d;
        }
        
        .range-moderate {
            background: #e9ecef;
            color: #7f8c8d;
        }
        
        .range-severe {
            background: #e9ecef;
            color: #7f8c8d;
        }
        
        .range-normal.active {
            background: #2ecc71;
            color: white;
        }
        
        .range-mild.active {
            background: #3498db;
            color: white;
        }
        
        .range-moderate.active {
            background: #f39c12;
            color: white;
        }
        
        .range-severe.active {
            background: #e74c3c;
            color: white;
        }
        
        .factor-interpretation {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            border-left: 3px solid #3498db;
        }
        
        .disclaimer {
            background: #fff8e1;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .result-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-save {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-save:hover {
            background: #27ae60;
        }
        
        .btn-retest {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-retest:hover {
            background: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .page {
                padding: 20px;
            }
            
            .options {
                flex-direction: column;
            }
            
            .option {
                min-width: 100%;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .score-card {
                grid-template-columns: 1fr;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .scoring-header, .scoring-explanation {
                flex-direction: column;
                text-align: center;
            }
            
            .scoring-explanation div {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- 介绍页面 -->
    <div class="page" id="intro-page">
        <h1>SCL-90症状自评量表</h1>
        <p class="subtitle">国际通用心理健康筛查工具</p>
        <p class="description">通过90道题目评估您近期的心理状态和情绪倾向，涵盖9个重要维度</p>
        
        <hr>
        
        <h2>评分标准</h2>
        <div class="scoring-section">
            <div class="scoring-header">
                <div>1=无</div>
                <div>2=轻度</div>
                <div>3=中度</div>
                <div>4=偏重</div>
                <div>5=严重</div>
            </div>
            <div class="scoring-explanation">
                <div>自觉并无该项症状</div>
                <div>自觉有该项症状，但发生得并不频繁、严重</div>
                <div>自觉有该项症状，其严重程度为轻到中度</div>
                <div>自觉常有该项症状，其程度为中到严重</div>
                <div>自觉该症状的频度和强度都十分严重</div>
            </div>
            <p class="note">根据最近1周内的实际感受选择，无需过度思考</p>
        </div>
        
        <hr>
        
        <div class="start-section">
            <h2>开始测试</h2>
            <button class="start-btn" id="start-btn">开始测试</button>
            
            <div class="important-note">
                <h3>重要提示：</h3>
                <p>本测试仅作为参考工具，不能替代专业诊断。</p>
                <p><strong>预计耗时：15-20分钟（请确保环境安静）</strong></p>
            </div>
        </div>
        
        <div class="footer">SCL-90</div>
    </div>
    
    <!-- 问题页面 -->
    <div class="page" id="question-page">
        <div class="question-header">
            <h1>SCL-90 症状自评量表</h1>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">问题 1/90</div>
        </div>
        
        <div id="question-container">
            <!-- 问题将通过JavaScript动态生成 -->
        </div>
        
        <div class="navigation">
            <button id="prev-btn">上一题</button>
            <button id="next-btn" style="display: none;">下一题</button>
        </div>
    </div>
    
    <!-- 结果页面 -->
    <div class="page" id="result-container">
        <div class="result-header">
            <h1 class="result-title">SCL-90 症状自评量表测试结果</h1>
            <p class="result-subtitle">提示:每次点击链接会刷新测试，点击尾部【保存结果截图】留存测试结果</p>
        </div>
        
        <div class="total-score-section">
            <h2>总评分结果报告</h2>
            <div class="score-card">
                <div class="score-item">
                    <div class="score-value" id="total-score">0</div>
                    <div class="score-label">总评分</div>
                    <div class="score-range">数值范围: 90-450</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="avg-score">0</div>
                    <div class="score-label">平均分</div>
                    <div class="score-range">数值范围: 1-5</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="positive-items">0</div>
                    <div class="score-label">阳性项目数</div>
                    <div class="score-range">数值范围: 0-90</div>
                </div>
                <div class="score-item">
                    <div class="score-value">
                        <span class="score-status" id="total-status">正常</span>
                    </div>
                    <div class="score-label">总体评估</div>
                    <div class="score-range">参考标准</div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-label">
                    <span>总分分布</span>
                    <span id="total-score-value">0/450</span>
                </div>
                <div class="chart-bar">
                    <div class="chart-fill" id="total-score-bar"></div>
                </div>
                <div class="chart-label">
                    <span>正常(&lt;160)</span>
                    <span>轻度(160-224)</span>
                    <span>中度(225-314)</span>
                    <span>重度(≥315)</span>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-label">
                    <span>阳性项目数</span>
                    <span id="positive-items-value">0/90</span>
                </div>
                <div class="chart-bar">
                    <div class="chart-fill" id="positive-items-bar"></div>
                </div>
                <div class="chart-label">
                    <span>正常(&lt;43)</span>
                    <span>阳性(≥43)</span>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-label">
                    <span>阳性症状均分</span>
                    <span id="positive-avg-value">0/5</span>
                </div>
                <div class="chart-bar">
                    <div class="chart-fill" id="positive-avg-bar"></div>
                </div>
                <div class="chart-label">
                    <span>正常(&lt;1.5)</span>
                    <span>轻度(1.5-2.4)</span>
                    <span>中度(2.5-3.4)</span>
                    <span>重度(≥3.5)</span>
                </div>
            </div>
        </div>
        
        <h2>各因子得分表</h2>
        <table class="factors-table">
            <thead>
                <tr>
                    <th>因子</th>
                    <th>总分</th>
                    <th>平均分</th>
                    <th>参考结果</th>
                </tr>
            </thead>
            <tbody id="factors-table-body">
                <!-- 因子数据将通过JavaScript动态生成 -->
            </tbody>
        </table>
        
        <div id="factor-analysis-container">
            <!-- 各维度评估将通过JavaScript动态生成 -->
        </div>
        
        <div class="disclaimer">
            <h3>关于结果的说明</h3>
            <p>本报告基于您的自评数据生成，可作为心理状态的参考，但不能替代专业医生的诊断。</p>
            <p>如果某些结果让您感到担忧，建议与心理咨询师或精神科医生进一步沟通。</p>
        </div>
        
        <div class="result-actions">
            <button class="btn-save" id="save-result-btn">保存结果截图</button>
            <button class="btn-retest" id="retest-btn">重新测试</button>
        </div>
    </div>

    <script>
        // SCL-90问题列表
        const questions = [
            "头痛",
            "神经过敏，心中不踏实",
            "头脑中有不必要的想法或字句盘旋",
            "头晕或昏倒",
            "对异性的兴趣减退",
            "对旁人责备求全",
            "感到别人能控制您的思想",
            "责怪别人制造麻烦",
            "忘记性大",
            "担心自己的衣饰整齐及仪态的端正",
            "容易烦恼和激动",
            "胸痛",
            "害怕空旷的场所或街道",
            "感到自己的精力下降，活动减慢",
            "想结束自己的生命",
            "听到旁人听不到的声音",
            "发抖",
            "感到大多数人都不可信任",
            "胃口不好",
            "容易哭泣",
            "同异性相处时感到害羞不自在",
            "感到受骗，中了圈套或有人想抓住您",
            "无缘无故地突然感到害怕",
            "自己不能控制地大发脾气",
            "怕单独出门",
            "经常责怪自己",
            "腰痛",
            "感到难以完成任务",
            "感到孤独",
            "感到苦闷",
            "过分担忧",
            "对事物不感兴趣",
            "感到害怕",
            "您的感情容易受到伤害",
            "旁人能知道您的私下想法",
            "感到别人不理解您、不同情您",
            "感到人们对您不友好，不喜欢您",
            "做事必须做得很慢以保证做得正确",
            "心跳得很厉害",
            "恶心或胃部不舒服",
            "感到比不上他人",
            "肌肉酸痛",
            "感到有人在监视您、谈论您",
            "难以入睡",
            "做事必须反复检查",
            "难以作出决定",
            "怕乘电车、公共汽车、地铁或火车",
            "呼吸有困难",
            "一阵阵发冷或发热",
            "因为感到害怕而避开某些东西、场合或活动",
            "脑子变空了",
            "身体发麻或刺痛",
            "喉咙有梗塞感",
            "感到前途没有希望",
            "不能集中注意",
            "感到身体的某一部分软弱无力",
            "感到紧张或容易紧张",
            "感到手或脚发重",
            "想到死亡的事",
            "吃得太多",
            "当别人看着您或谈论您时感到不自在",
            "有一些不属于您自己的想法",
            "有想打人或伤害他人的冲动",
            "醒得太早",
            "必须反复洗手、点数目或触摸某些东西",
            "睡得不稳不深",
            "有想摔坏或破坏东西的冲动",
            "有一些别人没有的想法或念头",
            "感到对别人神经过敏",
            "在商店或电影院等人多的地方感到不自在",
            "感到任何事情都很困难",
            "一阵阵恐惧或惊恐",
            "感到在公共场合吃东西很不舒服",
            "经常与人争论",
            "单独一人时神经很紧张",
            "别人对您的成绩没有作出恰当的评价",
            "即使和别人在一起也感到孤单",
            "感到坐立不安心神不定",
            "感到自己没有什么价值",
            "感到熟悉的东西变成陌生或不象是真的",
            "大叫或摔东西",
            "害怕会在公共场合昏倒",
            "感到别人想占您的便宜",
            "为一些有关'性'的想法而很苦恼",
            "您认为应该因为自己的过错而受到惩罚",
            "感到要很快地把事情做完",
            "感到自己的身体有严重问题",
            "从未感到和其他人很亲近",
            "感到自己有罪",
            "感到自己的脑子有毛病"
        ];

        // 维度分类
        const dimensions = {
            "躯体化": [0, 3, 11, 26, 39, 46, 49, 51, 55, 58],
            "强迫症状": [2, 9, 28, 35, 43, 59, 63, 72, 79, 83],
            "人际关系敏感": [1, 10, 33, 36, 57, 61, 69, 73, 77, 86],
            "抑郁": [5, 14, 15, 19, 29, 30, 37, 52, 64, 70, 80, 84, 88],
            "焦虑": [2, 17, 22, 32, 39, 56, 65, 71, 78, 85, 89],
            "敌对": [6, 13, 40, 60, 66, 74, 81],
            "恐怖": [7, 16, 23, 38, 45, 48, 62, 75, 82],
            "偏执": [8, 18, 42, 50, 68, 76, 87],
            "精神病性": [12, 20, 34, 47, 53, 67, 79, 86],
            "其他": [4, 21, 24, 25, 31, 41, 44, 54, 58, 69, 72, 83, 89]
        };

        // 各维度不同分数段的解释
        const factorInterpretations = {
            "躯体化": {
                normal: "您近期身体状态良好，无明显躯体不适症状。继续保持健康的生活习惯，适当运动，有助于维持良好状态。",
                mild: "您近期偶尔感到身体不适(如头痛、胃痛)，可能与压力或疲劳有关。建议：注意休息，适当运动，保持规律作息。",
                moderate: "您近期经常感到身体不适，如头痛、肌肉酸痛或胃部不适，这可能与持续压力有关。建议：适当减少工作压力，学习放松技巧，如深呼吸或冥想。",
                severe: "您近期身体不适症状明显且频繁，已对日常生活造成影响。建议：尽快就医检查，排除器质性疾病，同时寻求心理咨询帮助。"
            },
            "强迫症状": {
                normal: "您思维清晰，无明显强迫思维或行为。保持这种平衡状态对日常生活很有帮助。",
                mild: "您偶尔会出现重复想法或行为，但能通过自我调节缓解，不影响日常生活。建议：学习放松技巧，减少不必要的担忧。",
                moderate: "您经常出现不必要的想法或重复行为，已开始影响效率。建议：尝试认知行为疗法，学习打断强迫思维的方法。",
                severe: "您被强烈的强迫思维和行为困扰，严重影响日常生活。建议：尽快寻求专业心理治疗，可能需要药物辅助治疗。"
            },
            "人际关系敏感": {
                normal: "您在人际交往中感到自在，能够建立和维护健康的人际关系。继续保持开放和真诚的沟通方式。",
                mild: "您偶尔在社交中感到不自在，但对人际关系影响较小。建议：多参与社交活动，增强自信心。",
                moderate: "您在人际交往中经常感到紧张和不自在，可能回避某些社交场合。建议：逐步增加社交活动，学习社交技巧。",
                severe: "您对人际关系极度敏感，经常感到被他人评判或拒绝，严重影响社交功能。建议：寻求专业心理咨询，处理潜在的自我价值感问题。"
            },
            "抑郁": {
                normal: "您情绪稳定，能够享受生活，无明显抑郁症状。保持积极的生活态度和社交活动。",
                mild: "您情绪偶尔低落，兴趣减退，但能自我调节。建议：保持积极心态，与亲友交流，寻求支持。",
                moderate: "您经常感到情绪低落，对平日喜欢的活动失去兴趣，可能伴有睡眠或食欲改变。建议：寻求专业心理咨询，学习情绪调节技巧。",
                severe: "您持续感到极度沮丧、无助，可能有自杀念头。建议：立即寻求专业帮助，联系心理咨询师或精神科医生。"
            },
            "焦虑": {
                normal: "您心态平和，能够应对日常压力，无明显焦虑症状。保持这种平衡对身心健康有益。",
                mild: "您偶尔感到紧张或担忧，但能通过放松技巧缓解。建议：练习深呼吸、冥想等放松方法。",
                moderate: "您经常感到紧张不安，伴随身体症状如心悸、出汗，影响日常生活。建议：学习焦虑管理技巧，必要时寻求专业帮助。",
                severe: "您持续感到极度焦虑，可能有恐慌发作，严重影响生活质量。建议：立即寻求专业心理治疗，可能需要药物干预。"
            },
            "敌对": {
                normal: "您情绪稳定，能够以建设性方式表达不同意见，人际关系和谐。",
                mild: "您偶尔易怒，但能控制情绪反应。建议：学习情绪管理技巧，寻找健康的发泄方式。",
                moderate: "您经常感到愤怒和烦躁，容易与他人发生冲突。建议：学习愤怒管理技巧，寻找适当的情绪宣泄途径。",
                severe: "您难以控制愤怒情绪，可能有攻击性行为或想法。建议：立即寻求专业帮助，学习安全的情绪表达方式。"
            },
            "恐怖": {
                normal: "您对各种情境适应良好，无明显恐惧或回避行为。保持这种适应性对日常生活很重要。",
                mild: "您对特定场景(如高处)轻微回避，但不影响生活。建议：逐步接触恐惧源，建立安全感。",
                moderate: "您对某些情境有明显恐惧，会主动回避，影响日常活动。建议：尝试系统脱敏疗法，逐步面对恐惧。",
                severe: "您对某些情境有极度恐惧，可能导致恐慌发作，严重影响生活质量。建议：寻求专业暴露疗法和认知行为治疗。"
            },
            "偏执": {
                normal: "您思维开放，能够信任他人，无明显多疑或猜忌。保持这种信任对人际关系很重要。",
                mild: "您偶尔多疑，但能理性分析。建议：增强信任感，避免过度解读他人意图。",
                moderate: "您经常怀疑他人的动机，可能影响人际关系。建议：学习区分合理怀疑与过度猜忌，增强现实检验能力。",
                severe: "您有强烈的被害感或怀疑他人阴谋，严重影响社交功能。建议：尽快寻求专业心理治疗，可能需要药物治疗。"
            },
            "精神病性": {
                normal: "您思维清晰，与现实连接良好，无明显异常感知或思维。保持健康的生活方式有助于维持这种状态。",
                mild: "您偶尔出现异常感知或思维，但能保持现实检验能力。建议：保持稳定生活节奏，必要时寻求专业帮助。",
                moderate: "您经常出现异常思维或感知，开始影响对现实的判断。建议：尽快寻求专业评估和治疗，可能需要药物干预。",
                severe: "您有明显的思维混乱或感知异常，严重影响现实检验能力。建议：立即寻求专业精神科治疗，可能需要住院治疗。"
            },
            "其他": {
                normal: "您整体心理状态良好，无明显其他心理不适症状。继续保持健康的生活方式和积极的心态。",
                mild: "您存在一些轻微的心理不适症状，可能与近期生活压力有关。建议：关注整体心理健康，采取综合调节措施。",
                moderate: "您有明显的心理不适症状，已开始影响日常生活。建议：全面评估心理健康状况，寻求专业心理咨询。",
                severe: "您有多种明显的心理不适症状，严重影响生活质量。建议：尽快进行全面心理健康评估和治疗。"
            }
        };

        // 当前问题索引
        let currentQuestionIndex = 0;
        // 用户答案
        const userAnswers = new Array(questions.length).fill(0);

        // 页面元素
        const introPage = document.getElementById('intro-page');
        const questionPage = document.getElementById('question-page');
        const resultContainer = document.getElementById('result-container');
        const questionContainer = document.getElementById('question-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const startBtn = document.getElementById('start-btn');
        const saveResultBtn = document.getElementById('save-result-btn');
        const retestBtn = document.getElementById('retest-btn');

        // 开始测试按钮事件
        startBtn.addEventListener('click', function() {
            introPage.style.display = 'none';
            questionPage.style.display = 'block';
            showQuestion(currentQuestionIndex);
        });

        // 显示问题
        function showQuestion(index) {
            // 更新进度条
            const progress = ((index + 1) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `问题 ${index + 1}/${questions.length}`;
            
            // 生成问题HTML
            questionContainer.innerHTML = `
                <div class="question">
                    <div class="question-text">${index + 1}. ${questions[index]}</div>
                    <div class="options">
                        <div class="option">
                            <input type="radio" id="q${index}_1" name="q${index}" value="1" ${userAnswers[index] === 1 ? 'checked' : ''}>
                            <label for="q${index}_1">1分 - 从无</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_2" name="q${index}" value="2" ${userAnswers[index] === 2 ? 'checked' : ''}>
                            <label for="q${index}_2">2分 - 轻度</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_3" name="q${index}" value="3" ${userAnswers[index] === 3 ? 'checked' : ''}>
                            <label for="q${index}_3">3分 - 中度</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_4" name="q${index}" value="4" ${userAnswers[index] === 4 ? 'checked' : ''}>
                            <label for="q${index}_4">4分 - 偏重</label>
                        </div>
                        <div class="option">
                            <input type="radio" id="q${index}_5" name="q${index}" value="5" ${userAnswers[index] === 5 ? 'checked' : ''}>
                            <label for="q${index}_5">5分 - 严重</label>
                        </div>
                    </div>
                </div>
            `;
            
            // 更新按钮状态
            prevBtn.style.display = index === 0 ? 'none' : 'inline-block';
            
            // 添加选项选择事件 - 选择后自动跳转
            document.querySelectorAll(`input[name="q${index}"]`).forEach(input => {
                input.addEventListener('change', function() {
                    userAnswers[index] = parseInt(this.value);
                    
                    // 自动跳转到下一题
                    setTimeout(() => {
                        if (currentQuestionIndex < questions.length - 1) {
                            currentQuestionIndex++;
                            showQuestion(currentQuestionIndex);
                        } else {
                            // 如果是最后一题，自动提交
                            calculateResults();
                        }
                    }, 300); // 延迟300毫秒，让用户看到选择反馈
                });
            });
        }

        // 上一题按钮事件
        prevBtn.addEventListener('click', function() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        });

        // 计算并显示结果
        function calculateResults() {
            questionPage.style.display = 'none';
            resultContainer.style.display = 'block';
            
            // 计算总分
            const totalScore = userAnswers.reduce((sum, score) => sum + score, 0);
            const avgScore = totalScore / questions.length;
            
            // 计算阳性项目数（得分≥2的项目）
            const positiveItems = userAnswers.filter(score => score >= 2).length;
            const positiveAvgScore = positiveItems > 0 ? 
                userAnswers.filter(score => score >= 2).reduce((sum, score) => sum + score, 0) / positiveItems : 0;
            
            // 计算各维度得分
            const dimensionScores = {};
            Object.keys(dimensions).forEach(dim => {
                const dimQuestions = dimensions[dim];
                const dimTotal = dimQuestions.reduce((sum, index) => sum + userAnswers[index], 0);
                const dimAvg = dimTotal / dimQuestions.length;
                dimensionScores[dim] = {
                    total: dimTotal,
                    avg: dimAvg,
                    status: getStatusByScore(dimAvg)
                };
            });
            
            // 更新总分显示
            document.getElementById('total-score').textContent = totalScore;
            document.getElementById('avg-score').textContent = avgScore.toFixed(2);
            document.getElementById('positive-items').textContent = positiveItems;
            
            // 更新总分状态
            const totalStatus = getStatusByTotalScore(totalScore);
            const totalStatusElement = document.getElementById('total-status');
            totalStatusElement.textContent = totalStatus.text;
            totalStatusElement.className = 'score-status ' + totalStatus.class;
            
            // 更新图表
            document.getElementById('total-score-value').textContent = `${totalScore}/450`;
            document.getElementById('total-score-bar').style.width = `${(totalScore / 450) * 100}%`;
            
            document.getElementById('positive-items-value').textContent = `${positiveItems}/90`;
            document.getElementById('positive-items-bar').style.width = `${(positiveItems / 90) * 100}%`;
            
            document.getElementById('positive-avg-value').textContent = `${positiveAvgScore.toFixed(2)}/5`;
            document.getElementById('positive-avg-bar').style.width = `${(positiveAvgScore / 5) * 100}%`;
            
            // 更新因子得分表
            const factorsTableBody = document.getElementById('factors-table-body');
            factorsTableBody.innerHTML = '';
            
            Object.keys(dimensionScores).forEach(dim => {
                const score = dimensionScores[dim];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dim}</td>
                    <td>${score.total}</td>
                    <td>${score.avg.toFixed(2)}</td>
                    <td><span class="score-status ${score.status.class}">${score.status.text}</span></td>
                `;
                factorsTableBody.appendChild(row);
            });
            
            // 生成各维度评估
            const factorAnalysisContainer = document.getElementById('factor-analysis-container');
            factorAnalysisContainer.innerHTML = '<h2>各维度评估</h2>';
            
            Object.keys(dimensionScores).forEach(dim => {
                const score = dimensionScores[dim];
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'factor-analysis';
                
                // 根据分数确定哪个范围应该高亮
                let activeRange = '';
                if (score.avg < 1.5) {
                    activeRange = 'normal';
                } else if (score.avg < 2.5) {
                    activeRange = 'mild';
                } else if (score.avg < 3.5) {
                    activeRange = 'moderate';
                } else {
                    activeRange = 'severe';
                }
                
                analysisDiv.innerHTML = `
                    <div class="factor-title">${dim}因子分析</div>
                    <div class="factor-score-display">
                        <div class="factor-score-value">${score.avg.toFixed(2)}</div>
                        <div class="factor-score-bar">
                            <div class="factor-score-fill" style="width: ${(score.avg / 5) * 100}%"></div>
                        </div>
                    </div>
                    <div class="factor-ranges">
                        <span class="range-label range-normal ${activeRange === 'normal' ? 'active' : ''}">正常</span>
                        <span class="range-label range-mild ${activeRange === 'mild' ? 'active' : ''}">轻度</span>
                        <span class="range-label range-moderate ${activeRange === 'moderate' ? 'active' : ''}">中度</span>
                        <span class="range-label range-severe ${activeRange === 'severe' ? 'active' : ''}">重度</span>
                    </div>
                    <div class="factor-interpretation">
                        ${getFactorInterpretation(dim, score.avg)}
                    </div>
                `;
                
                factorAnalysisContainer.appendChild(analysisDiv);
            });
            
            // 滚动到结果区域
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // 根据平均分获取状态
        function getStatusByScore(score) {
            if (score < 1.5) return { text: '正常', class: 'status-normal' };
            if (score < 2.5) return { text: '轻度', class: 'status-mild' };
            if (score < 3.5) return { text: '中度', class: 'status-moderate' };
            return { text: '重度', class: 'status-severe' };
        }

        // 根据总分获取状态
        function getStatusByTotalScore(score) {
            if (score < 160) return { text: '正常', class: 'status-normal' };
            if (score < 225) return { text: '轻度', class: 'status-mild' };
            if (score < 315) return { text: '中度', class: 'status-moderate' };
            return { text: '重度', class: 'status-severe' };
        }

        // 获取因子解释
        function getFactorInterpretation(factor, score) {
            let level;
            if (score < 1.5) {
                level = "normal";
            } else if (score < 2.5) {
                level = "mild";
            } else if (score < 3.5) {
                level = "moderate";
            } else {
                level = "severe";
            }
            
            // 确保维度存在于解释对象中
            if (factorInterpretations[factor] && factorInterpretations[factor][level]) {
                return factorInterpretations[factor][level];
            }
            
            // 默认返回
            return "该维度评估结果正常，无明显心理不适症状。";
        }

        // 保存结果截图
        saveResultBtn.addEventListener('click', function() {
            // 使用html2canvas将结果容器转换为图片
            html2canvas(document.getElementById('result-container')).then(function(canvas) {
                // 创建一个下载链接
                const link = document.createElement('a');
                link.download = 'SCL-90测试结果.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        });

        // 重新测试按钮
        retestBtn.addEventListener('click', function() {
            // 重置测试状态
            currentQuestionIndex = 0;
            userAnswers.fill(0);
            
            // 显示介绍页面，隐藏结果页面
            resultContainer.style.display = 'none';
            introPage.style.display = 'block';
        });
    </script>
</body>
</html>